<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Baron Admin Panel</title>

<style>
body{margin:0;font-family:Arial;background:#0A0A0A;color:#EFEFEF;display:flex}
.sidebar{width:250px;background:#111;height:100vh;padding:20px;box-shadow:0 0 20px rgba(181,60,184,0.3)}
.sidebar h2{text-align:center;margin-bottom:30px}
.sidebar button{width:100%;margin-bottom:10px;padding:10px;background:none;border:1px solid #B53CB8;color:#EFEFEF;border-radius:8px;cursor:pointer}
.sidebar button:hover{background:#B53CB8}
.content{flex:1;padding:30px}
.section{display:none}
.section.active{display:block}
.card{background:#111;padding:15px;border-radius:10px;margin-bottom:15px;box-shadow:0 0 15px rgba(181,60,184,0.2)}
.low-stock{border:1px solid red}
.stat-box{background:#111;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 0 20px rgba(181,60,184,0.3)}
.stat-number{font-size:28px;color:#B53CB8}
.logout{margin-top:30px;background:#444!important}
</style>
</head>

<body>

<div class="sidebar">
<h2>Baron ğŸ‘‘</h2>
<button onclick="showSection('dashboard')">ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</button>
<button onclick="showSection('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
<button onclick="showSection('orders')">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
<button id="logoutBtn" class="logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="content">

<!-- Analytics -->
<div id="dashboard" class="section active">
<h1>ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h1>

<div class="stat-box">
Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
<div class="stat-number" id="totalProducts">0</div>
</div>

<div class="stat-box">
Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
<div class="stat-number" id="totalOrders">0</div>
</div>

<div class="stat-box">
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
<div class="stat-number" id="totalSales">0</div>
</div>

<div class="stat-box">
Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
<div class="stat-number" id="lowStockCount">0</div>
</div>

</div>

<!-- Inventory -->
<div id="inventory" class="section">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h1>
<div id="inventoryList"></div>
</div>

<!-- Orders -->
<div id="orders" class="section">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
<div id="ordersContainer"></div>
</div>

</div>

<script type="module">

import { auth, db } from "../firebase-config.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

onAuthStateChanged(auth,(user)=>{
    if(!user){window.location.href="login.html";}
});

document.getElementById("logoutBtn").addEventListener("click",()=>{
    signOut(auth).then(()=>{window.location.href="login.html";});
});

window.showSection = function(id){
    document.querySelectorAll(".section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(id).classList.add("active");
};

async function loadAnalytics(){
    const productsSnap = await getDocs(collection(db,"products"));
    const ordersSnap = await getDocs(collection(db,"orders"));

    document.getElementById("totalProducts").innerText = productsSnap.size;
    document.getElementById("totalOrders").innerText = ordersSnap.size;

    let totalSales=0;
    let lowStock=0;

    productsSnap.forEach(doc=>{
        const p=doc.data();
        if(p.stock <= 5){lowStock++;}
    });

    ordersSnap.forEach(doc=>{
        totalSales += doc.data().total;
    });

    document.getElementById("totalSales").innerText = totalSales + " Ø¯.Ù„";
    document.getElementById("lowStockCount").innerText = lowStock;
}

async function loadInventory(){
    const snapshot = await getDocs(collection(db,"products"));
    inventoryList.innerHTML="";
    snapshot.forEach(doc=>{
        const p = doc.data();
        const lowClass = p.stock <= 5 ? "low-stock" : "";
        inventoryList.innerHTML += `
            <div class="card ${lowClass}">
                <strong>${p.name}</strong><br>
                Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©: ${p.stock}
            </div>
        `;
    });
}

async function loadOrders(){
    const snapshot = await getDocs(collection(db,"orders"));
    ordersContainer.innerHTML="";
    snapshot.forEach(doc=>{
        const o = doc.data();
        ordersContainer.innerHTML += `
            <div class="card">
                ${o.customerName} - ${o.total} Ø¯.Ù„ - ${o.status}
            </div>
        `;
    });
}

loadAnalytics();
loadInventory();
loadOrders();

</script>

</body>
</html>
