<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Baron ERP System</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0A0A0A;color:#EFEFEF;display:flex}
.sidebar{width:270px;background:#111;height:100vh;padding:20px;overflow-y:auto;box-shadow:0 0 20px rgba(181,60,184,0.3)}
.sidebar h2{text-align:center;margin-bottom:20px}
.sidebar button{width:100%;margin-bottom:8px;padding:10px;background:none;border:1px solid #B53CB8;color:#EFEFEF;border-radius:8px;cursor:pointer}
.sidebar button:hover{background:#B53CB8}
.content{flex:1;padding:30px;overflow-y:auto}
.section{display:none}
.section.active{display:block}
.card{background:#111;padding:15px;border-radius:10px;margin-bottom:15px}
input,select{width:100%;padding:8px;margin-bottom:10px;border-radius:8px;border:1px solid #B53CB8;background:#111;color:#EFEFEF}
button.action{background:#B53CB8;border:none;padding:8px 12px;color:white;border-radius:8px;margin-top:5px;cursor:pointer}
.low{border:1px solid red}
.stat{font-size:20px;margin-bottom:15px}
</style>
</head>
<body>

<div class="sidebar">
<h2>Baron ERP ğŸ‘‘</h2>
<button onclick="show('analytics')">ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</button>
<button onclick="show('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
<button onclick="show('orders')">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
<button onclick="show('subscriptions')">ğŸ’³ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</button>
<button onclick="show('suppliers')">ğŸ¢ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
<button onclick="show('agents')">ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</button>
<button onclick="show('invoices')">ğŸ§¾ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
</div>

<div class="content">

<div id="analytics" class="section active">
<h1>ØªØ­Ù„ÙŠÙ„Ø§Øª Ø¹Ø§Ù…Ø©</h1>
<div class="stat">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: <span id="totalSales">0</span></div>
<canvas id="salesChart"></canvas>
</div>

<div id="inventory" class="section">
<h1>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h1>
<div id="inventoryList"></div>
</div>

<div id="orders" class="section">
<h1>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
<div id="ordersList"></div>
</div>

<div id="subscriptions" class="section">
<h1>Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h1>
<div id="subsList"></div>
</div>

<div id="suppliers" class="section">
<h1>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h1>
<input id="supplierName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ±Ø¯">
<button class="action" onclick="addSupplier()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="supplierList"></div>
</div>

<div id="agents" class="section">
<h1>Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</h1>
<input id="agentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨">
<button class="action" onclick="addAgent()">Ø¥Ø¶Ø§ÙØ©</button>
<div id="agentList"></div>

<h3>ØªØ³Ù„ÙŠÙ… Ø¨Ø¶Ø§Ø¹Ø©</h3>
<select id="agentSelect"></select>
<select id="productSelect"></select>
<input type="number" id="agentQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<button class="action" onclick="deliverToAgent()">ØªØ³Ù„ÙŠÙ…</button>
</div>

<div id="invoices" class="section">
<h1>ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h1>
<select id="supplierSelect"></select>
<select id="invoiceProduct"></select>
<input type="number" id="invoiceQty" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<button class="action" onclick="addInvoice()">Ø¥Ø¶Ø§ÙØ© ÙØ§ØªÙˆØ±Ø©</button>
</div>

</div>

<script type="module">

import { db } from "../firebase-config.js";
import { collection, getDocs, addDoc, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

window.show = function(id){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
};

async function loadAll(){

const products=await getDocs(collection(db,"products"));
const orders=await getDocs(collection(db,"orders"));
const suppliers=await getDocs(collection(db,"suppliers"));
const agents=await getDocs(collection(db,"agents"));
const subs=await getDocs(collection(db,"subscriptions"));

let total=0;

inventoryList.innerHTML="";
productSelect.innerHTML="";
invoiceProduct.innerHTML="";

products.forEach(d=>{
const p=d.data();
if(p.stock<=5){
inventoryList.innerHTML+=`<div class="card low">${p.name} - ${p.stock}</div>`;
}else{
inventoryList.innerHTML+=`<div class="card">${p.name} - ${p.stock}</div>`;
}
productSelect.innerHTML+=`<option value="${d.id}">${p.name}</option>`;
invoiceProduct.innerHTML+=`<option value="${d.id}">${p.name}</option>`;
});

ordersList.innerHTML="";
orders.forEach(d=>{
total+=d.data().total;
ordersList.innerHTML+=`<div class="card">${d.data().customerName} - ${d.data().total}</div>`;
});

document.getElementById("totalSales").innerText=total+" Ø¯.Ù„";

supplierList.innerHTML="";
supplierSelect.innerHTML="";
suppliers.forEach(d=>{
supplierList.innerHTML+=`<div class="card">${d.data().name}</div>`;
supplierSelect.innerHTML+=`<option value="${d.id}">${d.data().name}</option>`;
});

agentList.innerHTML="";
agentSelect.innerHTML="";
agents.forEach(d=>{
agentList.innerHTML+=`<div class="card">${d.data().name} - Ø§Ù„Ø¯ÙŠÙ†: ${d.data().debt||0}</div>`;
agentSelect.innerHTML+=`<option value="${d.id}">${d.data().name}</option>`;
});

subsList.innerHTML="";
subs.forEach(d=>{
subsList.innerHTML+=`<div class="card">${d.data().name}</div>`;
});

}

window.addSupplier=async function(){
await addDoc(collection(db,"suppliers"),{name:supplierName.value});
supplierName.value="";
loadAll();
};

window.addAgent=async function(){
await addDoc(collection(db,"agents"),{name:agentName.value,debt:0});
agentName.value="";
loadAll();
};

window.addInvoice=async function(){
const productRef=doc(db,"products",invoiceProduct.value);
const snap=await getDocs(collection(db,"products"));
let product;
snap.forEach(d=>{if(d.id===invoiceProduct.value) product=d.data();});
await updateDoc(productRef,{stock:product.stock+Number(invoiceQty.value)});
await addDoc(collection(db,"supplierInvoices"),{
supplierId:supplierSelect.value,
productId:invoiceProduct.value,
qty:Number(invoiceQty.value),
createdAt:new Date()
});
loadAll();
};

window.deliverToAgent=async function(){
const productRef=doc(db,"products",productSelect.value);
const snap=await getDocs(collection(db,"products"));
let product;
snap.forEach(d=>{if(d.id===productSelect.value) product=d.data();});
if(product.stock<agentQty.value){alert("Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØºÙŠØ± ÙƒØ§Ù");return;}

await updateDoc(productRef,{stock:product.stock-Number(agentQty.value)});

const agents=await getDocs(collection(db,"agents"));
let agentDoc;
agents.forEach(d=>{if(d.id===agentSelect.value) agentDoc=d;});
const newDebt=(agentDoc.data().debt||0)+(product.price*Number(agentQty.value));
await updateDoc(doc(db,"agents",agentSelect.value),{debt:newDebt});

await addDoc(collection(db,"agentDeliveries"),{
agentId:agentSelect.value,
productId:productSelect.value,
qty:Number(agentQty.value),
value:product.price*Number(agentQty.value),
createdAt:new Date()
});

loadAll();
};

loadAll();

</script>
</body>
</html>
