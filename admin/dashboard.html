<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Baron Admin Panel</title>

<style>
body{margin:0;font-family:Arial;background:#0A0A0A;color:#EFEFEF;display:flex}
.sidebar{width:250px;background:#111;height:100vh;padding:20px;box-shadow:0 0 20px rgba(181,60,184,0.3)}
.sidebar h2{text-align:center;margin-bottom:30px}
.sidebar button{width:100%;margin-bottom:10px;padding:10px;background:none;border:1px solid #B53CB8;color:#EFEFEF;border-radius:8px;cursor:pointer}
.sidebar button:hover{background:#B53CB8}
.content{flex:1;padding:30px}
.section{display:none}
.section.active{display:block}
.stat-box{background:#111;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 0 20px rgba(181,60,184,0.3)}
.stat-number{font-size:24px;color:#B53CB8}
.notification{
background:#2a0f0f;
border:1px solid red;
padding:15px;
border-radius:10px;
margin-bottom:20px;
color:#ff8080;
}
.logout{margin-top:30px;background:#444!important}
</style>
</head>

<body>

<div class="sidebar">
<h2>Baron ğŸ‘‘</h2>
<button onclick="showSection('dashboard')">ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</button>
<button onclick="showSection('orders')">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
<button id="logoutBtn" class="logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="content">

<div id="dashboard" class="section active">
<h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h1>

<div id="notificationArea"></div>

<div class="stat-box">
Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…
<div class="stat-number" id="todaySales">0</div>
</div>

<div class="stat-box">
Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…
<div class="stat-number" id="todayOrders">0</div>
</div>

<div class="stat-box">
Ù…Ø¨ÙŠØ¹Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±
<div class="stat-number" id="monthSales">0</div>
</div>

<div class="stat-box">
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙƒÙ„ÙŠ
<div class="stat-number" id="totalSales">0</div>
</div>

</div>

<div id="orders" class="section">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
<div id="ordersContainer"></div>
</div>

</div>

<script type="module">

import { auth, db } from "../firebase-config.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

onAuthStateChanged(auth,(user)=>{
    if(!user){window.location.href="login.html";}
});

document.getElementById("logoutBtn").addEventListener("click",()=>{
    signOut(auth).then(()=>{window.location.href="login.html";});
});

window.showSection = function(id){
    document.querySelectorAll(".section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(id).classList.add("active");
};

async function loadAnalytics(){

    const productsSnap = await getDocs(collection(db,"products"));
    const ordersSnap = await getDocs(collection(db,"orders"));

    let lowStock=0;
    productsSnap.forEach(doc=>{
        if(doc.data().stock <= 5){lowStock++;}
    });

    if(lowStock > 0){
        document.getElementById("notificationArea").innerHTML =
        `<div class="notification">
        âš  ÙŠÙˆØ¬Ø¯ ${lowStock} Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        </div>`;
    }

    let totalSales=0;
    let todaySales=0;
    let monthSales=0;
    let todayOrders=0;

    const now = new Date();
    const today = now.toDateString();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();

    ordersSnap.forEach(doc=>{
        const o = doc.data();
        const orderDate = o.createdAt.toDate();
        totalSales += o.total;

        if(orderDate.toDateString() === today){
            todaySales += o.total;
            todayOrders++;
        }

        if(orderDate.getMonth() === currentMonth && orderDate.getFullYear() === currentYear){
            monthSales += o.total;
        }
    });

    document.getElementById("todaySales").innerText = todaySales + " Ø¯.Ù„";
    document.getElementById("todayOrders").innerText = todayOrders;
    document.getElementById("monthSales").innerText = monthSales + " Ø¯.Ù„";
    document.getElementById("totalSales").innerText = totalSales + " Ø¯.Ù„";
}

async function loadOrders(){
    const snapshot = await getDocs(collection(db,"orders"));
    ordersContainer.innerHTML="";
    snapshot.forEach(doc=>{
        const o = doc.data();
        ordersContainer.innerHTML+=`
            <div class="stat-box">
                ${o.customerName} - ${o.total} Ø¯.Ù„ - ${o.status}
            </div>
        `;
    });
}

loadAnalytics();
loadOrders();

</script>

</body>
</html>
