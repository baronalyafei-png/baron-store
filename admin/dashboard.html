<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Dashboard - Baron</title>

<style>
body{
    background:#0A0A0A;
    color:#EFEFEF;
    font-family:Arial;
    margin:0;
    padding:20px;
}

h1{
    text-align:center;
}

.section{
    margin-top:40px;
}

.order-card{
    background:#111;
    padding:15px;
    border-radius:10px;
    margin-bottom:15px;
    box-shadow:0 0 15px rgba(181,60,184,0.3);
}

button{
    margin-top:10px;
    padding:6px 10px;
    background:#B53CB8;
    border:none;
    color:white;
    border-radius:6px;
    cursor:pointer;
}
button:hover{
    opacity:0.9;
}

.logout{
    margin-top:40px;
    background:#444;
}
</style>
</head>

<body>

<h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Baron ğŸ‘‘</h1>

<div class="section">
<h2>Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h2>
<div id="newOrders"></div>
</div>

<div class="section">
<h2>Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</h2>
<div id="processingOrders"></div>
</div>

<div class="section">
<h2>ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</h2>
<div id="deliveredOrders"></div>
</div>

<button id="logoutBtn" class="logout">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>

<script type="module">

import { auth, db } from "../firebase-config.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØµÙØ­Ø©
onAuthStateChanged(auth, (user) => {
    if (!user) {
        window.location.href = "login.html";
    }
});

// ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬
document.getElementById("logoutBtn").addEventListener("click", () => {
    signOut(auth).then(() => {
        window.location.href = "login.html";
    });
});

const newDiv = document.getElementById("newOrders");
const processingDiv = document.getElementById("processingOrders");
const deliveredDiv = document.getElementById("deliveredOrders");

async function loadOrders(){

    const querySnapshot = await getDocs(collection(db, "orders"));

    newDiv.innerHTML = "";
    processingDiv.innerHTML = "";
    deliveredDiv.innerHTML = "";

    querySnapshot.forEach((docSnap) => {

        const order = docSnap.data();
        const id = docSnap.id;

        const html = `
            <div class="order-card">
                <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${order.customerName}</p>
                <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${order.customerPhone}</p>
                <p><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${order.total} Ø¯.Ù„</p>
                <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${order.status}</p>
                <button onclick="updateStatus('${id}','Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²')">Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²</button>
                <button onclick="updateStatus('${id}','ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…')">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
            </div>
        `;

        if(order.status === "Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯"){
            newDiv.innerHTML += html;
        }else if(order.status === "Ù‚ÙŠØ¯ Ø§Ù„ØªØ¬Ù‡ÙŠØ²"){
            processingDiv.innerHTML += html;
        }else{
            deliveredDiv.innerHTML += html;
        }

    });
}

window.updateStatus = async function(id, status){
    const orderRef = doc(db, "orders", id);
    await updateDoc(orderRef, { status: status });
    loadOrders();
}

loadOrders();

</script>

</body>
</html>
