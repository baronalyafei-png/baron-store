<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Baron Admin Panel</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0A0A0A;color:#EFEFEF;display:flex}
.sidebar{width:250px;background:#111;height:100vh;padding:20px;box-shadow:0 0 20px rgba(181,60,184,0.3)}
.sidebar h2{text-align:center;margin-bottom:30px}
.sidebar button{width:100%;margin-bottom:10px;padding:10px;background:none;border:1px solid #B53CB8;color:#EFEFEF;border-radius:8px;cursor:pointer}
.sidebar button:hover{background:#B53CB8}
.content{flex:1;padding:30px;overflow-y:auto}
.section{display:none}
.section.active{display:block}
.stat-box{background:#111;padding:20px;border-radius:12px;margin-bottom:20px;box-shadow:0 0 20px rgba(181,60,184,0.3)}
.notification{background:#2a0f0f;border:1px solid red;padding:15px;border-radius:10px;margin-bottom:20px;color:#ff8080}
.card{background:#111;padding:15px;border-radius:10px;margin-bottom:15px}
.low-stock{border:1px solid red}
.logout{margin-top:30px;background:#444!important}
canvas{background:#111;padding:20px;border-radius:12px}
</style>
</head>

<body>

<div class="sidebar">
<h2>Baron ğŸ‘‘</h2>
<button onclick="showSection('dashboard')">ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</button>
<button onclick="showSection('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
<button onclick="showSection('orders')">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
<button id="logoutBtn" class="logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="content">

<!-- Dashboard -->
<div id="dashboard" class="section active">
<h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h1>

<div id="notificationArea"></div>

<div class="stat-box">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: <span id="totalSales">0</span></div>

<h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…</h3>
<canvas id="salesChart"></canvas>

<h3 style="margin-top:40px;">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…</h3>
<canvas id="ordersChart"></canvas>

</div>

<!-- Inventory -->
<div id="inventory" class="section">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h1>
<div id="inventoryList"></div>
</div>

<!-- Orders -->
<div id="orders" class="section">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
<div id="ordersContainer"></div>
</div>

</div>

<script type="module">

import { auth, db } from "../firebase-config.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

onAuthStateChanged(auth,(user)=>{
    if(!user){window.location.href="login.html";}
});

document.getElementById("logoutBtn").addEventListener("click",()=>{
    signOut(auth).then(()=>{window.location.href="login.html";});
});

window.showSection = function(id){
    document.querySelectorAll(".section").forEach(sec=>sec.classList.remove("active"));
    document.getElementById(id).classList.add("active");
};

async function loadData(){

    const productsSnap = await getDocs(collection(db,"products"));
    const ordersSnap = await getDocs(collection(db,"orders"));

    let lowStock=0;
    let totalSales=0;

    let dailySales = {};
    let dailyOrders = {};

    productsSnap.forEach(doc=>{
        if(doc.data().stock <= 5){lowStock++;}
    });

    if(lowStock > 0){
        document.getElementById("notificationArea").innerHTML =
        `<div class="notification">
        âš  ÙŠÙˆØ¬Ø¯ ${lowStock} Ù…Ù†ØªØ¬Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        </div>`;
    }

    ordersSnap.forEach(doc=>{
        const o = doc.data();
        const date = o.createdAt.toDate().toLocaleDateString();

        totalSales += o.total;

        dailySales[date] = (dailySales[date] || 0) + o.total;
        dailyOrders[date] = (dailyOrders[date] || 0) + 1;
    });

    document.getElementById("totalSales").innerText = totalSales + " Ø¯.Ù„";

    createChart("salesChart","Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª",dailySales);
    createChart("ordersChart","Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª",dailyOrders);
}

function createChart(canvasId,label,dataObj){

    const labels = Object.keys(dataObj);
    const values = Object.values(dataObj);

    new Chart(document.getElementById(canvasId), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: values,
                borderColor: '#B53CB8',
                backgroundColor: 'rgba(181,60,184,0.2)',
                tension: 0.4
            }]
        },
        options: {
            plugins:{
                legend:{labels:{color:"#EFEFEF"}}
            },
            scales:{
                x:{ticks:{color:"#EFEFEF"}},
                y:{ticks:{color:"#EFEFEF"}}
            }
        }
    });
}

async function loadInventory(){
    const snapshot = await getDocs(collection(db,"products"));
    inventoryList.innerHTML="";
    snapshot.forEach(doc=>{
        const p = doc.data();
        const lowClass = p.stock <= 5 ? "low-stock" : "";
        inventoryList.innerHTML += `
            <div class="card ${lowClass}">
                ${p.name} â€” Ø§Ù„ÙƒÙ…ÙŠØ©: ${p.stock}
            </div>
        `;
    });
}

async function loadOrders(){
    const snapshot = await getDocs(collection(db,"orders"));
    ordersContainer.innerHTML="";
    snapshot.forEach(doc=>{
        const o = doc.data();
        ordersContainer.innerHTML+=`
            <div class="card">
                ${o.customerName} - ${o.total} Ø¯.Ù„ - ${o.status}
            </div>
        `;
    });
}

loadData();
loadInventory();
loadOrders();

</script>

</body>
</html>
