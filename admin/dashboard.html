<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Baron Admin Panel</title>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0A0A0A;
    color:#EFEFEF;
    display:flex;
}
.sidebar{
    width:250px;
    background:#111;
    height:100vh;
    padding:20px;
    box-shadow:0 0 20px rgba(181,60,184,0.3);
}
.sidebar h2{
    text-align:center;
    margin-bottom:30px;
}
.sidebar button{
    width:100%;
    margin-bottom:10px;
    padding:10px;
    background:none;
    border:1px solid #B53CB8;
    color:#EFEFEF;
    border-radius:8px;
    cursor:pointer;
}
.sidebar button:hover{
    background:#B53CB8;
}
.content{
    flex:1;
    padding:30px;
}
.section{
    display:none;
}
.section.active{
    display:block;
}
.card{
    background:#111;
    padding:15px;
    border-radius:10px;
    margin-bottom:15px;
    box-shadow:0 0 15px rgba(181,60,184,0.2);
}
button.action{
    background:#B53CB8;
    border:none;
    padding:6px 10px;
    border-radius:6px;
    color:white;
    cursor:pointer;
    margin-right:5px;
}
.logout{
    margin-top:30px;
    background:#444 !important;
}
input, textarea{
    width:100%;
    padding:8px;
    margin:5px 0;
    border:none;
    border-radius:6px;
}
.stat-box{
    background:#111;
    padding:20px;
    border-radius:12px;
    margin-bottom:20px;
    box-shadow:0 0 20px rgba(181,60,184,0.3);
}
.stat-number{
    font-size:28px;
    color:#B53CB8;
}
</style>
</head>

<body>

<div class="sidebar">
<h2>Baron ğŸ‘‘</h2>
<button onclick="showSection('dashboard')">ğŸ“Š Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</button>
<button onclick="showSection('products')">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
<button onclick="showSection('orders')">ğŸ›’ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
<button id="logoutBtn" class="logout">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
</div>

<div class="content">

<!-- Analytics -->
<div id="dashboard" class="section active">
<h1>ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…ØªØ¬Ø±</h1>

<div class="stat-box">
Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
<div class="stat-number" id="totalProducts">0</div>
</div>

<div class="stat-box">
Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
<div class="stat-number" id="totalOrders">0</div>
</div>

<div class="stat-box">
Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
<div class="stat-number" id="totalSales">0</div>
</div>

</div>

<!-- Products -->
<div id="products" class="section">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>

<input type="text" id="productName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input type="number" id="productPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input type="number" id="productStock" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<input type="text" id="productCategory" placeholder="Ø§Ù„ÙØ¦Ø©">
<input type="text" id="productColor" placeholder="Ø§Ù„Ù„ÙˆÙ†">
<textarea id="productDescription" placeholder="Ø§Ù„ÙˆØµÙ"></textarea>
<input type="text" id="productImage" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">

<button class="action" onclick="addOrUpdateProduct()">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button>

<h3 style="margin-top:30px;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
<div id="productList"></div>
</div>

<!-- Orders -->
<div id="orders" class="section">
<h1>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
<div id="ordersContainer"></div>
</div>

</div>

<script type="module">

import { auth, db } from "../firebase-config.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

let editingId = null;

onAuthStateChanged(auth,(user)=>{
    if(!user){
        window.location.href="login.html";
    }
});

document.getElementById("logoutBtn").addEventListener("click",()=>{
    signOut(auth).then(()=>{
        window.location.href="login.html";
    });
});

window.showSection = function(id){
    document.querySelectorAll(".section").forEach(sec=>{
        sec.classList.remove("active");
    });
    document.getElementById(id).classList.add("active");
};

/* Ø¥Ø¶Ø§ÙØ© Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ */
window.addOrUpdateProduct = async function(){

    const name = productName.value;
    const price = Number(productPrice.value);
    const stock = Number(productStock.value);
    const category = productCategory.value;
    const color = productColor.value;
    const description = productDescription.value;
    const image = productImage.value;

    if(editingId){
        await updateDoc(doc(db,"products",editingId),{
            name,price,stock,category,color,description,image
        });
        editingId = null;
        alert("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ ğŸ‘‘");
    }else{
        await addDoc(collection(db,"products"),{
            name,price,stock,category,color,description,image,
            createdAt:new Date()
        });
        alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ ğŸ‘‘");
    }

    clearForm();
    loadProducts();
    loadAnalytics();
};

function clearForm(){
    productName.value="";
    productPrice.value="";
    productStock.value="";
    productCategory.value="";
    productColor.value="";
    productDescription.value="";
    productImage.value="";
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
async function loadProducts(){
    const snapshot = await getDocs(collection(db,"products"));
    productList.innerHTML="";
    snapshot.forEach(docSnap=>{
        const p = docSnap.data();
        productList.innerHTML+=`
            <div class="card">
                <strong>${p.name}</strong> - ${p.price} Ø¯.Ù„
                <br>Ø§Ù„ÙƒÙ…ÙŠØ©: ${p.stock}
                <br>
                <button class="action" onclick="editProduct('${docSnap.id}','${p.name}','${p.price}','${p.stock}','${p.category}','${p.color}','${p.description}','${p.image}')">ØªØ¹Ø¯ÙŠÙ„</button>
                <button class="action" onclick="deleteProduct('${docSnap.id}')">Ø­Ø°Ù</button>
            </div>
        `;
    });
}

window.deleteProduct = async function(id){
    if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ")){
        await deleteDoc(doc(db,"products",id));
        loadProducts();
        loadAnalytics();
    }
};

window.editProduct = function(id,name,price,stock,category,color,description,image){
    editingId = id;
    productName.value=name;
    productPrice.value=price;
    productStock.value=stock;
    productCategory.value=category;
    productColor.value=color;
    productDescription.value=description;
    productImage.value=image;
};

/* Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª */
async function loadOrders(){
    const snapshot = await getDocs(collection(db,"orders"));
    ordersContainer.innerHTML="";
    snapshot.forEach(docSnap=>{
        const o = docSnap.data();
        ordersContainer.innerHTML+=`
            <div class="card">
                ${o.customerName} - ${o.total} Ø¯.Ù„ - ${o.status}
            </div>
        `;
    });
}

/* Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª */
async function loadAnalytics(){

    const productsSnap = await getDocs(collection(db,"products"));
    const ordersSnap = await getDocs(collection(db,"orders"));

    document.getElementById("totalProducts").innerText = productsSnap.size;
    document.getElementById("totalOrders").innerText = ordersSnap.size;

    let totalSales = 0;
    ordersSnap.forEach(doc=>{
        totalSales += doc.data().total;
    });

    document.getElementById("totalSales").innerText = totalSales + " Ø¯.Ù„";
}

loadProducts();
loadOrders();
loadAnalytics();

</script>

</body>
</html>
