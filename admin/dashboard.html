<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Baron ERP Pro</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0A0A0A;color:#EFEFEF;display:flex}
.sidebar{width:280px;background:#111;height:100vh;padding:20px;overflow-y:auto}
.sidebar button{width:100%;margin-bottom:8px;padding:10px;background:none;border:1px solid #B53CB8;color:#EFEFEF;border-radius:8px}
.sidebar button:hover{background:#B53CB8}
.content{flex:1;padding:30px;overflow-y:auto}
.section{display:none}
.section.active{display:block}
.card{background:#111;padding:15px;border-radius:10px;margin-bottom:15px}
input{width:100%;padding:8px;margin-bottom:8px;border-radius:8px;background:#111;color:#fff;border:1px solid #B53CB8}
button.action{background:#B53CB8;border:none;padding:8px 12px;color:white;border-radius:8px;margin-top:5px}
.low{border:1px solid red}
.stat{font-size:18px;margin-bottom:10px}
</style>
</head>
<body>

<div class="sidebar">
<h2>Baron ERP ğŸ‘‘</h2>
<button onclick="show('accounts')">ğŸ’° Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</button>
<button onclick="show('suppliers')">ğŸ§¾ ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</button>
<button onclick="show('agents')">ğŸ‘¨â€ğŸ’¼ Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</button>
<button onclick="show('inventory')">ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
</div>

<div class="content">

<!-- Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª -->
<div id="accounts" class="section active">
<h1>Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ</h1>
<div class="stat">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: <span id="salesTotal">0</span></div>
<div class="stat">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ø¶Ø§Ø¹Ø©: <span id="costTotal">0</span></div>
<div class="stat">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­: <span id="profitTotal">0</span></div>
<div class="stat">Ø¯ÙŠÙˆÙ† Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨: <span id="agentsDebt">0</span></div>
<div class="stat">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙØ¹Ù„ÙŠ: <span id="netProfit">0</span></div>
</div>

<!-- ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† -->
<div id="suppliers" class="section">
<h1>ÙØ§ØªÙˆØ±Ø© Ù…ÙˆØ±Ø¯ ÙŠØ¯ÙˆÙŠØ©</h1>

<input id="prodName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input id="prodBarcode" placeholder="Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ ID">
<input id="prodQty" type="number" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<input id="prodCost" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">
<input id="prodPrice" type="number" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">

<button class="action" onclick="addManualInvoice()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</button>
<div id="invoiceLog"></div>
</div>

<!-- Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨ -->
<div id="agents" class="section">
<h1>Ø§Ù„Ù…Ù†Ø§Ø¯ÙŠØ¨</h1>
<input id="agentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨">
<button class="action" onclick="addAgent()">Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¯ÙˆØ¨</button>

<div id="agentsList"></div>

<h3>Ø³Ø¯Ø§Ø¯ Ø¯ÙŠÙ†</h3>
<input id="payAgentId" placeholder="ID Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨">
<input id="payAmount" type="number" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
<button class="action" onclick="payAgent()">ØªØ³Ø¯ÙŠØ¯</button>
</div>

<!-- Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
<div id="inventory" class="section">
<h1>Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h1>
<div id="inventoryList"></div>
</div>

</div>

<script type="module">

import { db } from "../firebase-config.js";
import { collection, addDoc, getDocs, doc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

window.show = function(id){
document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
document.getElementById(id).classList.add("active");
};

async function addManualInvoice(){

const name=prodName.value;
const barcode=prodBarcode.value;
const qty=Number(prodQty.value);
const cost=Number(prodCost.value);
const price=Number(prodPrice.value);

const products=await getDocs(collection(db,"products"));
let existing=null;

products.forEach(d=>{
if(d.data().barcode===barcode) existing=d;
});

if(existing){
await updateDoc(doc(db,"products",existing.id),{
stock:existing.data().stock+qty,
costPrice:cost,
price:price
});
}else{
await addDoc(collection(db,"products"),{
name:name,
barcode:barcode,
stock:qty,
costPrice:cost,
price:price
});
}

await addDoc(collection(db,"supplierInvoices"),{
name,barcode,qty,cost,price,
createdAt:new Date()
});

invoiceLog.innerHTML="<div class='card'>ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>";
loadAll();
}

window.addAgent=async function(){
await addDoc(collection(db,"agents"),{name:agentName.value,debt:0});
agentName.value="";
loadAll();
};

window.payAgent=async function(){
const agents=await getDocs(collection(db,"agents"));
agents.forEach(async d=>{
if(d.id===payAgentId.value){
const newDebt=(d.data().debt||0)-Number(payAmount.value);
await updateDoc(doc(db,"agents",d.id),{debt:newDebt});
await addDoc(collection(db,"agentPayments"),{
agentId:d.id,
amount:Number(payAmount.value),
createdAt:new Date()
});
}
});
loadAll();
};

async function loadAll(){

const orders=await getDocs(collection(db,"orders"));
const products=await getDocs(collection(db,"products"));
const agents=await getDocs(collection(db,"agents"));

let sales=0,costTotal=0,profit=0,agentsDebt=0;

orders.forEach(o=>sales+=o.data().total);

products.forEach(p=>{
costTotal+= (p.data().costPrice||0)*p.data().stock;
});

orders.forEach(o=>{
o.data().items.forEach(item=>{
profit+= (item.price-(item.costPrice||0))*item.qty;
});
});

agents.forEach(a=>agentsDebt+=(a.data().debt||0));

document.getElementById("salesTotal").innerText=sales;
document.getElementById("costTotal").innerText=costTotal;
document.getElementById("profitTotal").innerText=profit;
document.getElementById("agentsDebt").innerText=agentsDebt;
document.getElementById("netProfit").innerText=sales-costTotal;

inventoryList.innerHTML="";
products.forEach(p=>{
inventoryList.innerHTML+=`<div class="card">${p.data().name} - ${p.data().stock}</div>`;
});

agentsList.innerHTML="";
agents.forEach(a=>{
agentsList.innerHTML+=`<div class="card">ID:${a.id}<br>${a.data().name}<br>Ø§Ù„Ø¯ÙŠÙ†:${a.data().debt||0}</div>`;
});

}

loadAll();

</script>
</body>
</html>
